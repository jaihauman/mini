<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>MiniApp Reward Unlock (Monetag Universal)</title>

<!-- Telegram -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- Monetag Rewarded SDK (your zone) -->
<script src="//libtl.com/sdk.js" data-zone="8555852" data-sdk="show_8555852"></script>

<style>
body{
  background:#0f1720;
  color:white;
  font-family:Arial;
  padding:20px;
}
.card{
  background:#1f2937;
  padding:15px;
  border-radius:10px;
  margin-bottom:20px;
}
.thumb{
  width:100%;
  height:180px;
  object-fit:cover;
  border-radius:10px;
}
.unlockBtn{
  margin-top:10px;
  width:100%;
  padding:10px;
  background:#06b6d4;
  color:white;
  font-size:16px;
  border:none;
  border-radius:8px;
}
.unlockedBtn{
  display:none;
  margin-top:10px;
  width:100%;
  padding:10px;
  background:#16a34a;
  color:white;
  font-size:16px;
  border:none;
  border-radius:8px;
}
#status{
  margin-top:15px;
  color:#93a3af;
}
</style>
</head>

<body>

<h2>Premium Content</h2>
<p>Watch a Monetag rewarded ad to unlock this content.</p>

<div class="card">
  <img class="thumb" src="https://placehold.co/600x400?text=Premium+Video">
  <h3>Exclusive YouTube Video</h3>
  <p>Must watch rewarded ad to unlock.</p>

  <button id="unlockBtn" class="unlockBtn">Watch Ad To Unlock</button>
  <button id="openBtn" class="unlockedBtn">Open Content</button>
</div>

<div id="status">Ready</div>

<script>
const YT_LINK = "https://www.youtube.com/watch?v=_PxpEmSc3zo&list=LL";
let current = false;

// open content
document.getElementById("openBtn").onclick = () => {
  window.open(YT_LINK, "_blank");
};

// start ad
document.getElementById("unlockBtn").onclick = () => {
  current = true;
  update("Loading ad...");

  if (typeof window.show_8555852 === "function") {
    try {
      window.show_8555852();
      update("Ad is playing...");
    } catch(e) {
      update("Error: Ad failed");
      alert("Ad failed to load.");
    }
  } else {
    update("SDK not loaded");
    alert("Monetag SDK not loaded!");
  }
};

// ----------------------------
// UNIVERSAL MONETAG CALLBACKS
// ----------------------------

// 1) standard callback
window.show_8555852_callback = function(event, data){
  console.log("Monetag callback:", event, data);
  handleRewardEvent(event);
};

// 2) alternative event names
document.addEventListener("reward", ()=>handleRewardEvent("reward"));
document.addEventListener("rewarded", ()=>handleRewardEvent("reward"));
document.addEventListener("complete", ()=>handleRewardEvent("reward"));
document.addEventListener("monetag_reward", ()=>handleRewardEvent("reward"));
document.addEventListener("monetag.complete", ()=>handleRewardEvent("reward"));

// 3) Monetag Reward Object alternative
if (window.MonetagReward && window.MonetagReward.on) {
  MonetagReward.on("reward", ()=>handleRewardEvent("reward"));
}

// reward handler
function handleRewardEvent(ev){
  if (!current) return;
  if (ev !== "reward" && ev !== "complete") return;

  current = false;
  unlock();
}

// unlock function
function unlock(){
  update("Reward completed! Unlocked.");

  document.getElementById("unlockBtn").style.display = "none";
  document.getElementById("openBtn").style.display = "block";
}

function update(t){
  document.getElementById("status").textContent = t;
}
</script>
<script src="//libtl.com/sdk.js" data-zone="8555852" data-sdk="show_8555852"></script>

<button onclick="startAd()">WATCH AD</button>

<script>
function log(x){ console.log("%c " + x, "background:#222; color:#0f0; padding:4px"); }

function startAd(){
    log("Ad requested...");
    try {
        show_8555852();
        log("show_8555852() called");
    } catch(e) {
        log("ERROR calling show_8555852(): " + e);
    }
}

/* --- MONETAG CALLBACK SNIFFERS --- */

// official callback (if used)
window.show_8555852_callback = function(event, data){
    log("callback: " + event + " | " + JSON.stringify(data));
};

// detect ANY event
[
    "reward","rewarded","complete","finished",
    "monetag_reward","monetag.completed","monetag.reward",
    "done","ad_complete"
].forEach(ev=>{
    document.addEventListener(ev, ()=>{
        log("DOM EVENT FIRED: " + ev);
    });
});

// detect MonetagReward object
let intv = setInterval(()=>{
    if (window.MonetagReward && MonetagReward.on){
        log("MonetagReward object detected");
        MonetagReward.on("reward", ()=>{
            log("MonetagReward reward event fired");
        });
        clearInterval(intv);
    }
},500);
</script>

</body>
</html>
